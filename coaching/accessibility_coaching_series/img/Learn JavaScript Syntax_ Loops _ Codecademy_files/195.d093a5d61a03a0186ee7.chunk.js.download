(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[195],{"1aMd":function(e,t,a){"use strict";a.d(t,"a",(function(){return RegistrationForm_RegistrationForm}));var i=a("wx14"),r=a("rePB"),s=a("DzJC"),n=a.n(s),o=a("E+oP"),c=a.n(o),l=a("Z0cm"),d=a.n(l),p=a("G8Hi"),m=a("FZcb"),u=a("kVzq"),h=a("TSYQ"),b=a.n(h),v=a("q1tI"),_=a.n(v),f=a("24Ii"),g=a.n(f),E=a("xk4V"),S=a.n(E),y=a("f8p9"),C=a("DAui"),O=a("tYyt"),j=a("z9go"),N=a("OLDM"),k=a("ev9x"),F=a("hFGM"),I=a("gtj7"),R=a("b0K7"),w=a("NWss"),V=a("vOOB"),P={registrationContainer:"registrationContainer__1DWVArjxkRSHEqpISv3YfU",registrationContainerCompact:"registrationContainerCompact__3f5fD0mXckkhzC_gkXDQaJ",screenReaderOnly:"screenReaderOnly__2S7ruRxpd1VhnuyeMz0di2",submitButton:"submitButton__1syIjVGtZiGfg2aBWCcvkZ",submitButtonCompact:"submitButtonCompact__DTD3_nPUjcDW2juBilPyk",tos:"tos__2S7BNNliayxJrYfZEqHGOH",fieldset:"fieldset__2IcsxborktqVvm5FdfygAO",formCompact:"formCompact__Q6nQtda86q7aKdsfLQSvz",formGroupsCompact:"formGroupsCompact__1e0cWED9TSZNrITxnH3MoV",formGroupCompact:"formGroupCompact__225iYntNRtxkKn05IYqtJ1",inputCompact:"inputCompact__2Shf6uPLKjgQGwlRGM6u4D",validCheckmark:"validCheckmark__FINN8PBxaKyExgp8BuWaN",inputWrapper:"inputWrapper__1WcSn7pm4PiUUt2d3hgszk",hidden:"hidden__IE7yAQczIi7NG5Xaf2XMv",recaptchaError:"recaptchaError__2PRVQPBckCquoqnpNkolaI",formGroup:"formGroup__26lWN6IoN44keRivjjZbD7",padBottomIfNotEmpty:"padBottomIfNotEmpty__SRLk-qQ59lLzCQRc26yql","grecaptcha-badge":"grecaptcha-badge"},x=a("oHca"),B=a("5sab"),D=a("05V4"),z=a("ANOs"),G="validationText__2V8IomQ7py3ImJSkR74lUL",U="tooltip__SfXUpCRO-J9ns7jIIcq-2",L="tipWrapper__2EqLYLfvCkkov8Czpsfpvc",q="tooltipTarget__2QEgWo1UnUfrI64N8g5a7R",A="infoIcon__1g_zfaxGIRIbEh291YxmGv",T="tooltipContents__2bqd9NtbRxq1kYIR2tCLhZ";const K={password:z.a},ValidationError=e=>{if(!e.validationError)return null;const t=K[e.fieldName];return t?_.a.createElement("div",{className:U},_.a.createElement(x.a,{focusable:!0,id:"".concat(e.fieldName,"-tooltip"),target:_.a.createElement("div",{className:q},_.a.createElement("span",{"aria-live":"assertive",className:G},e.validationError),_.a.createElement(D.a,{size:12,className:A})),position:x.b.BottomRight,tipClassName:L},_.a.createElement(B.a,{text:t,spacing:"tight",className:T}))):_.a.createElement("span",{"aria-live":"assertive",className:G},e.validationError)};function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const W=[{name:"email",label:w.emailLabel,type:"email",invalidMessage:"Please use a valid email address",pattern:void 0},{name:"password",label:w.passwordLabel,type:"password",invalidMessage:"is not long enough",pattern:".{6,128}"}],H="/register/validate",extractValidationErrors=e=>{const t=e.body.errors;return t&&Object.values(t).filter((e=>e))?Object.entries(t).reduce(((e,[t,a])=>_objectSpread(_objectSpread({},e),{},{[t]:d()(a)?V[a[0]]:V[a]||a})),{}):null};class RegistrationForm_RegistrationForm extends v.Component{constructor(...e){super(...e),this.idPrefix="sign_up_form_",this.state={disabled:!1,recaptchaInstanceId:S()(),validationErrors:{},validatedFields:new Set([])},this.onRecapChange=e=>{this.submitForm(e)},this.onRecapExpire=()=>{this.resetRecaptcha()},this.onSuccessfulValidation=e=>{this.setValidationErrorState({[e]:void 0}),this.setState((t=>({validatedFields:t.validatedFields.add(e)})))},this.onFailedValidation=(e,t)=>{this.setValidationErrorState({[e]:t}),this.setState((t=>(t.validatedFields.delete(e),{validatedFields:t.validatedFields})))},this.onSubmissionFailedValidation=e=>{this.setValidationErrorState(e),this.setState((t=>{Object.keys(e).forEach((e=>{t.validatedFields.delete(e)})),this.setState({validatedFields:t.validatedFields})}))},this.submitForm=e=>{g.a.post("/register").send(_objectSpread(_objectSpread({},this.serialize()),{},{"g-recaptcha-response":e})).use(F.b).accept("json").then((({body:e})=>{Object(j.a)("user_sign_up"),Object(N.b)("user_sign_up"),this.setState({disabled:!1}),this.props.onSuccess(e)})).catch((e=>{const t=extractValidationErrors(e.response);this.setState({disabled:!1}),t&&this.onSubmissionFailedValidation(t),this.resetRecaptcha()}))},this.onSubmitInitialize=e=>(e.preventDefault(),this.isValid()?(this.setState({disabled:!0}),g.a.post(H).send(this.serialize()).use(F.b).accept("json").then((()=>{this.captcha.execute()})).catch((e=>{const t=extractValidationErrors(e.response);t&&this.onSubmissionFailedValidation(t),this.setState({disabled:!1})}))):null),this.genericClientSideValidityHandler=(e,t)=>{const a=t.target.validity.valueMissing,i=t.target.validity.valid;let r;a?r="can't be blank":i||(r=W.find((t=>t.name===e)).invalidMessage),r?this.onFailedValidation(e,r):this.onSuccessfulValidation(e)},this.genericServerSideValidityHandler=n()(((e,t)=>{t.target.value?g.a.post(H).send({user:{[e]:t.target.value}}).use(F.b).accept("json").then((()=>{this.onSuccessfulValidation(e)})).catch((t=>{const a=extractValidationErrors(t.response);(null==a?void 0:a[e])?this.onFailedValidation(e,a[e]):this.onSuccessfulValidation(e)})):this.onFailedValidation(e,"can't be blank")}),250),this.validateField=(e,t)=>{"password"===e?this.genericClientSideValidityHandler(e,t):this.genericServerSideValidityHandler(e,t)},this.onFieldBlur=e=>{e.persist();const t=this.serialize().user||{},a=t.email,i=void 0===a?"":a,r=t.password,s=void 0===r?"":r;c()(i)&&c()(s)||this.validateField(e.target.name,e)},this.onFieldKeyUp=e=>{e.persist();const t=e.target.name;this.state.validationErrors[t]&&this.validateField(t,e)},this.onSubmitClick=()=>{Object(j.c)({target:"create_account"})},this.setFormRef=e=>{this.form=e},this.setCaptchaRef=e=>{this.captcha=e}}setValidationErrorState(e,t={}){this.setState((a=>_objectSpread({validationErrors:_objectSpread(_objectSpread({},a.validationErrors),e)},t)))}isValid(){return!Object.values(this.state.validationErrors).filter((e=>e)).length}serialize(){return[...this.form.elements].filter((e=>e.name)).reduce(((e,t)=>{const a=t.dataset.resource;return _objectSpread(_objectSpread({},e),{},a?{[a]:_objectSpread(_objectSpread({},e[a]),{},{[t.name]:t.value})}:{[t.name]:t.value})}),{})}resetRecaptcha(){this.setState({recaptchaInstanceId:S()(),disabled:!1})}render(){const e=O.a.get("authenticity_token"),t=this.props,a=t.ctaText,r=t.currentPage,s=t.defaultValues,n=void 0===s?{email:"",password:""}:s,o=t.disableFieldset,c=t.hideOauth,l=t.hideRecaptchaInfo,d=t.hideSubmitButton,h=t.locationType,v=t.markValidatedFields,f=t.redirectUrl,g=t.submitButtonProps,E=t.compact,S=t.classNames,j=void 0===S?{}:S,N=t.isStudent,k="location/EXERCISE"===h,F=this.state.disabled,R=f&&Object(I.e)(f),V=b()("recaptcha-wrapper",{[P.padBottomIfNotEmpty]:E});return _.a.createElement("div",{className:b()(P.registrationContainer,j.container,{[P.registrationContainerCompact]:E})},_.a.createElement("form",{onSubmit:this.onSubmitInitialize,noValidate:!0,ref:this.setFormRef,method:"POST"},_.a.createElement("fieldset",{className:P.fieldset,disabled:o},_.a.createElement("input",{name:"authenticity_token",type:"hidden",value:e}),_.a.createElement("input",{name:"coding_reminders_comms_timezone","data-resource":"user",type:"hidden",value:Intl.DateTimeFormat().resolvedOptions().timeZone}),_.a.createElement("input",{name:"signing_up_from_exercise",type:"hidden",value:"".concat(k)}),N&&_.a.createElement("input",{name:"student_access",type:"hidden",value:1}),_.a.createElement("input",{name:"referring_page",type:"hidden",value:r}),_.a.createElement("input",{name:"redirect",type:"hidden",value:R}),_.a.createElement("div",{className:b()(P.formGroups,{[P.formGroupsCompact]:E},j.formGroups)},W.map((e=>_.a.createElement(p.d,{key:"".concat(this.idPrefix).concat(e.name),htmlFor:"".concat(this.idPrefix).concat(e.name),label:e.label,className:b()(P.formGroup,{[P.formGroupCompact]:E})},_.a.createElement(ValidationError,{fieldName:e.name,validationError:this.state.validationErrors[e.name]}),_.a.createElement("div",{className:P.inputWrapper},_.a.createElement(p.g,{"aria-invalid":this.state.validationErrors[e.name]?"true":void 0,className:b()(P.input,{[P.inputCompact]:E},j.input),"data-testid":"".concat(e.name,"-field"),htmlFor:"".concat(this.idPrefix).concat(e.name),name:e.name,type:e.type,onBlur:this.onFieldBlur,onKeyUp:this.onFieldKeyUp,required:!0,error:!!this.state.validationErrors[e.name],pattern:e.pattern,"data-resource":"user",defaultValue:n[e.name]}),v&&this.state.validatedFields.has(e.name)&&_.a.createElement(u.a,{className:P.validCheckmark})))))),_.a.createElement("div",{className:V},this.state.validationErrors.recaptcha&&_.a.createElement("div",{className:P.recaptchaError,"data-testid":"recaptcha-error"},this.state.validationErrors.recaptcha),_.a.createElement(C.a,{key:this.state.recaptchaInstanceId,publicKey:O.a.get("recaptcha_key"),size:"invisible",ref:this.setCaptchaRef,onChange:this.onRecapChange,onExpired:this.onRecapExpire})),_.a.createElement("div",{className:j.footer},_.a.createElement(m.a,Object(i.a)({},g,{onClick:this.onSubmitClick,type:"submit",className:b()(P.submitButton,{[P.submitButtonCompact]:E,[P.hidden]:d},j.submitButton),disabled:F,id:"".concat(this.idPrefix,"submit"),"data-testid":"registration-form-submit"}),a),!l&&_.a.createElement("p",{className:b()(P.tos,j.tos),dangerouslySetInnerHTML:{__html:w.recaptchaTOS}})))),!c&&_.a.createElement(y.a,{signUp:!0,urlParams:{redirect:R}}))}}RegistrationForm_RegistrationForm.defaultProps={onSuccess:({redirectTo:e,workerSupportApplicant:t})=>{Object(k.g)(e)?window.location.assign(Object(I.e)(e||Object(R.lb)())):window.location.assign(Object(I.e)((({redirectUrl:e,workerSupportApplicant:t})=>t?R.nc:Object(R.Ib)({redirectUrl:e,fromSignUpPage:!0}))({redirectUrl:e,workerSupportApplicant:t})))},submitButtonProps:{size:"large",theme:"brand-purple"},ctaText:w.createAccountCTA,isStudent:!1}},vOOB:function(e){e.exports=JSON.parse('{"weak":"too weak","breach":"We\'ve detected that the password you\'ve entered may not be secure. Please create a new one.","length":"is not long enough"}')}}]);
//# sourceMappingURL=195.d093a5d61a03a0186ee7.chunk.js.map