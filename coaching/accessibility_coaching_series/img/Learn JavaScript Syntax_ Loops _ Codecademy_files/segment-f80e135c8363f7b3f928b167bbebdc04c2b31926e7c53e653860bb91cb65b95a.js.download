const fetchDestinationForWriteKey=async e=>{try{const t=await window.fetch(`https://cdn.segment.com/v1/projects/${e}/integrations`);if(!t.ok)throw new Error(`Failed to fetch integrations for write key ${e}: HTTP ${t.status} ${t.statusText}`);const n=await t.json();for(const e of n)e.id=e.creationName,delete e.creationName;return n}catch(i){}},conditionallyLoadAnalytics=({writeKey:e,destinationPreferences:i,identifyPreferences:t,user:n})=>{window.analytics.initialized||(window.analytics.load(e,{integrations:i}),window.analytics.page(),n&&window.analytics.identify(n._id,{email:n.email},{integrations:t}))},mapDestinations=(e,i)=>{const t=window.OnetrustActiveGroups||["C0001"],n=!!i&&parseInt(i._id.slice(-1),16)%2==0,s=["Advertising","Attribution","Email Marketing"],o=["Analytics","Customer Success"],r=[];return[e.map(e=>s.includes(e.category)?{[e.id]:t.includes("C0004")}:r.includes(e.category)?{[e.id]:t.includes("C0003")}:o.includes(e.category)?{[e.id]:t.includes("C0002")}:{[e.id]:!0}).reduce((e,i)=>({...i,...e}),{"Segment.io":t.includes("C0003"),FullStory:n}),{All:!1,FullStory:n,Hindsight:t.includes("C0004"),UserLeap:t.includes("C0002")}]};window.initializeSegment=(e=>{if(!e)return;const i=window.CCDATA&&window.CCDATA.current_user;fetchDestinationForWriteKey(e).then(t=>{if(!t)return;const[n,s]=mapDestinations(t,i);conditionallyLoadAnalytics({writeKey:e,destinationPreferences:n,identifyPreferences:s,user:i})})});